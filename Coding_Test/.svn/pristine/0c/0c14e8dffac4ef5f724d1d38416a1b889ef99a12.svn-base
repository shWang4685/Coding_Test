package com.itest.testcases.codingHome;

import java.util.Set;
import lazy.test.tools.util.asserts.Assert;
import lazy.test.ui.annotations.TextContent;
import org.apache.log4j.Logger;
import org.openqa.selenium.By;
import org.openqa.selenium.NoSuchElementException;
import org.openqa.selenium.TimeoutException;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.support.ui.ExpectedCondition;
import org.openqa.selenium.support.ui.ExpectedConditions;
import org.openqa.selenium.support.ui.WebDriverWait;
import org.testng.ITestContext;
import org.testng.annotations.BeforeClass;
import org.testng.annotations.Test;
import com.itest.utils.GetBorwser;
import com.itest.utils.LogConfiguration;
import com.itest.utils.SeleniumUtil;
/**
 * 首页登录
 * @author 24431
 *
 */
public class CodingHome_002_Login_Test {
    static Logger logger=Logger.getLogger(CodingHome_002_Login_Test.class);
    //设置上下文存驱动，在监听器种有使用
    ITestContext itestContext=null;
    WebDriver driver=null;
    
    @BeforeClass
    public void beforeTest(ITestContext itestContext){
        this.itestContext=itestContext;
        this.driver=new GetBorwser().getWebDriver();       
        itestContext.setAttribute("SELENIUM_DRIVER", driver);
        LogConfiguration.initLog(this.getClass().getSimpleName());
    }
    @Test
    public void login(){
        SeleniumUtil seleniumUtil=new SeleniumUtil(driver);
        //打开官网
        driver.get("https://coding.qq.com/home/");
        driver.manage().window().maximize();
        //点击标签，显示等待
        //elementCheck(driver,By.xpath("//*[@id=\"app\"]/div/div/div/div[1]/div[3]/div/a"));
        driver.findElement(By.xpath("//*[@id=\"app\"]/div/div/div/div[1]/div[3]/div/a")).click();
        driver.switchTo().frame("qq_login_iframe");
        driver.switchTo().frame("ptlogin_iframe");
       //elementCheck(driver,By.xpath("//*[@id=\"switcher_plogin\"]"));
        driver.findElement(By.xpath("//*[@id=\"switcher_plogin\"]")).click();
        //输入账号密码,登录
        driver.findElement(By.xpath("//*[@id=\"u\"]")).sendKeys("244313089");
        seleniumUtil.pause(1000);
        driver.findElement(By.xpath("//*[@id=\"p\"]")).sendKeys("1qaz@WSX");
        seleniumUtil.pause(1000);
        driver.findElement(By.xpath("//*[@id=\"login_button\"]")).click();
        seleniumUtil.pause(1000);
        String homeHandle=driver.getWindowHandle();
        //点击校园标签，查看能否拉起校园模块，验证登录是否成功使用
        driver.findElement(By.xpath("//*[@id=\"app\"]/div/div/div/div[1]/div[2]/a[3]")).click();
        Set<String> allHandle=driver.getWindowHandles();
        for (String s:allHandle){
          if(s.equals(homeHandle)){
            continue;
          }else{
            driver.switchTo().window(s);
            break;
          }
        }      
        //验证登录是否成功
        String url=driver.getCurrentUrl();
        if(url.equals("https://coding.qq.com/studentSys/")){
          logger.info("[登录成功了]");
        }else{
          logger.info("[登录失败了]");
          Assert.fail("[登录失败了]");
        }
        
        seleniumUtil.pause(1000);
        driver.quit();

    } 
    
    
    
    public static void elementCheck(WebDriver driver,By by){
       try{
         ITestContext itestContext=null;        
         WebDriverWait wait=new WebDriverWait(driver,1);
         wait.until(ExpectedConditions.elementToBeClickable(by));         
       }catch(TimeoutException e){
         logger.error("[等待超时]："+by);
         Assert.fail("[等待超时]："+by);
       }

    }
    
    
    
    
    
}
